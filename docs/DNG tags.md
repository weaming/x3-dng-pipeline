# DNG 标签概述

DNG (Digital Negative) 是 Adobe 设计的一种开放、无损的原始图像格式。它旨在为不同相机型号生成的原始数据提供一个统一的、公开可用的存档标准。DNG 文件内部使用标签（Tags）来存储图像数据、元数据以及处理指令。

这些标签基于 TIFF/EP (Tag Image File Format / Electronic Photography) 标准，并进行了扩展，以适应原始图像数据的复杂需求。

## 常见的 DNG 标签及其作用

以下是一些在 DNG 文件中常见的关键标签，它们在定义图像的渲染方式中扮演着重要角色：

| 标签 (Tag)                                  | 描述                                                                                                                                  |
| :------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------ |
| **DNGVersion**                              | 指定创建该文件所依据的 DNG 规范版本。这对于解析器了解应如何处理文件至关重要。                                                         |
| **UniqueCameraModel**                       | 相机的唯一、非本地化名称。这有助于软件精确地加载该相机型号的特定配置文件。                                                            |
| **ColorMatrix1 / ColorMatrix2**             | 定义从 CIE XYZ 色彩空间到相机原始色彩空间的转换矩阵。通常会提供两个矩阵，分别对应不同的光源（例如日光和钨丝灯），以便进行白平衡插值。 |
| **CameraCalibration1 / CameraCalibration2** | 包含用于修正 `ColorMatrix` 的校准矩阵，以进一步精确匹配特定相机的色彩特性。                                                           |
| **AsShotNeutral**                           | 记录拍摄时由相机确定的中性色（白平衡）的坐标。这是软件确定“拍摄时设置”白平衡的依据。                                                  |
| **BlackLevel**                              | 指定传感器的“黑电平”，即在没有光线照射时传感器的输出值。这是原始数据线性化的第一步。                                                  |
| **WhiteLevel**                              | 指定传感器的饱和点，即传感器能够记录的最大值。                                                                                        |
| **LinearizationTable**                      | 如果相机的原始数据不是线性的，此表定义了一个查找表（LUT），用于将非线性数据转换为线性数据。                                           |
| **NoiseProfile**                            | 描述图像中的噪声特性（通常是亮度和色度噪声），以便降噪算法可以更精确地处理噪声。                                                      |
| **ProfileToneCurve**                        | 定义一个默认的色调曲线，可以在处理图像时作为起点。                                                                                    |
| **ProfileEmbedPolicy**                      | 指定相机配置文件的嵌入策略，例如是否允许被自由复制或只能随图像使用。                                                                  |
| **OriginalRawFileName**                     | 如果该 DNG 文件是从另一种原始格式（如 CR2, NEF）转换而来，此标签会记录原始文件的名称。                                                |

---

## Adobe Lightroom 中的 DNG 标签应用

Adobe Lightroom 作为一款强大的数字资产管理和原始数据处理软件，深度依赖 DNG 格式。然而，Lightroom 并不总是直接修改 DNG 文件中的所有标签。其标准流程有以下特点：

1.  **使用 XMP 存储编辑信息**:

    - 当你在 Lightroom 中对 DNG 文件进行编辑时（例如调整曝光、对比度、白平衡等），这些调整并**不会**直接改写 `ColorMatrix` 或 `AsShotNeutral` 等基础 DNG 标签。
    - 相反，所有的编辑指令和元数据（如关键字、评级）都被记录在 DNG 文件内的一个**XMP (Extensible Metadata Platform)** 数据块中。
    - 这样做的好处是保留了原始的、未经修改的相机数据，使得“重置”操作可以轻松实现，同时也保证了编辑的非破坏性。

2.  **读取关键 DNG 标签进行初始渲染**:

    - 当 Lightroom 首次导入并渲染一个 DNG 文件时，它会读取 `ColorMatrix`, `BlackLevel`, `WhiteLevel` 等基础标签来构建图像的初始预览。
    - 它还会读取 `AsShotNeutral` 标签来应用“拍摄时”的白平衡设置。

3.  **DNG 相机配置文件 (DCP)**:

    - Lightroom 的色彩渲染严重依赖于 **DNG 相机配置文件 (.dcp)**。这些配置文件包含了更复杂的色彩转换表和色调曲线，比简单的 `ColorMatrix` 更能精确地模拟相机的色彩特性或实现特定的艺术风格（例如 "Adobe Color", "Adobe Landscape"）。
    当应用一个 DCP 文件时，其内部的指令会覆盖 DNG 文件中基础的色彩矩阵，从而实现对图像外观的完全控制。

4.  **在 Lightroom 中可见的 DNG 标签**:
    - 在 Lightroom 的“元数据”面板中，你可以直接查看一些 DNG 相关的标签，例如：
      - `DNGVersion`: DNG 版本。
      - `DNGCompatibility`: DNG 兼容性信息。
      - `LightroomCompatibility`: Lightroom 兼容性信息。
      - 同时，标准的 EXIF 和 IPTC 元数据（如相机型号、镜头信息、GPS 数据等）也同样被读取和显示。

综上所述，Lightroom 的标准流程是将 DNG 标签作为图像的**基础状态和原始数据**，而将所有的**编辑和调整**存储在附加的 XMP 数据块中。这使得 DNG 成为了一个既包含原始传感器数据又包含完整编辑历史的、独立的数字资产。
